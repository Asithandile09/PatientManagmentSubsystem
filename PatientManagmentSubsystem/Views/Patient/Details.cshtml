@model PatientManagmentSubsystem.Models.Patient
@{
    ViewData["Title"] = "Patient Folder - " + Model.FirstName + " " + Model.LastName;
}

<div class="container-fluid px-0">
    <div class="page-header">
        <h2 class="page-title">
            <i class="bi bi-folder"></i> Patient Folder: @Model.FirstName @Model.LastName
        </h2>
        <p class="page-subtitle">Complete medical record and history</p>
    </div>

    <!-- Patient Basic & Medical Information -->
    <div class="row g-4">
        <div class="col-lg-6">
            <div class="info-card card-burgundy">
                <div class="info-card-header">
                    <i class="bi bi-person-circle"></i>
                    <h5>Basic Information</h5>
                </div>
                <div class="info-card-body">
                    <div class="info-row">
                        <span class="info-label">Patient ID:</span>
                        <span class="info-value">#@Model.PatientId</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Full Name:</span>
                        <span class="info-value">@Model.FirstName @Model.LastName</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Gender:</span>
                        <span class="info-value">@Model.Gender</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Date of Birth:</span>
                        <span class="info-value">@Model.DOB.ToShortDateString()</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Age:</span>
                        <span class="info-value">@((DateTime.Now - Model.DOB).Days / 365) years</span>
                    </div>
                    @if (!string.IsNullOrEmpty(Model.Phone))
                    {
                        <div class="info-row">
                            <span class="info-label">Phone:</span>
                            <span class="info-value">@Model.Phone</span>
                        </div>
                    }
                    @if (!string.IsNullOrEmpty(Model.Email))
                    {
                        <div class="info-row">
                            <span class="info-label">Email:</span>
                            <span class="info-value">@Model.Email</span>
                        </div>
                    }
                    @if (Model.Addresses != null && Model.Addresses.Any())
                    {
                        <div class="info-row">
                            <span class="info-label">Address:</span>
                            <span class="info-value">@Model.Addresses.First().Street</span>
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="info-card card-teal">
                <div class="info-card-header">
                    <i class="bi bi-heart-pulse"></i>
                    <h5>Medical Information</h5>
                </div>
                <div class="info-card-body">
                    <div class="info-row">
                        <span class="info-label">Admission Date:</span>
                        <span class="info-value">
                            <span class="badge badge-info">@Model.AdmissionDate.ToString("MMM dd, yyyy HH:mm")</span>
                        </span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Days Admitted:</span>
                        <span class="info-value">@((DateTime.Now - Model.AdmissionDate).Days) days</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Assigned Doctor:</span>
                        <span class="info-value">
                            @if (Model.Doctor != null)
                            {
                                <strong>Dr. @Model.Doctor.FirstName @Model.Doctor.LastName</strong>
                                @if (!string.IsNullOrEmpty(Model.Doctor.Specialty))
                                {
                                    <br />
                            
                                    <small class="text-muted">@Model.Doctor.Specialty</small>
                                }
                            }
                            else
                            {
                                <span class="text-danger">No doctor assigned</span>
                            }
                        </span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Current Ward:</span>
                        <span class="info-value">
                            @if (Model.Ward != null)
                            {
                                <span class="badge badge-ward">@Model.Ward.Name</span>
                            }
                            else
                            {
                                <span class="text-warning">No ward assigned</span>
                            }
                        </span>
                    </div>
                    @if (ViewBag.CurrentBed != null)
                    {
                        <div class="info-row">
                            <span class="info-label">Assigned Bed:</span>
                            <span class="info-value">
                                <span class="badge badge-gold">@ViewBag.CurrentBed.Name</span>
                            </span>
                        </div>
                    }
                    <div class="info-row">
                        <span class="info-label">Taking Medication:</span>
                        <span class="info-value">
                            @if (Model.IsTakingMedication)
                            {
                                <span class="badge badge-warning">Yes</span>
                                @if (!string.IsNullOrEmpty(Model.MedicationName))
                                {
                                    <br />
                            
                                    <small>@Model.MedicationName</small>
                                }
                            }
                            else
                            {
                                <span class="badge badge-secondary">No</span>
                            }
                        </span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Status:</span>
                        <span class="info-value">
                            @if (Model.IsActive)
                            {
                                <span class="badge badge-active">Active</span>
                            }
                            else
                            {
                                <span class="badge badge-inactive">Inactive</span>
                            }
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Medical History Card -->
    @if (Model.MedicalHistory != null)
    {
        <div class="row g-4 mt-2">
            <div class="col-12">
                <div class="info-card card-rose">
                    <div class="info-card-header">
                        <i class="bi bi-clipboard2-pulse"></i>
                        <h5>Medical History</h5>
                    </div>
                    <div class="info-card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="history-section-title">Health Conditions</h6>
                                <ul class="history-list">
                                    @if (Model.MedicalHistory.HasAllergies)
                                    {
                                        <li class="history-item">
                                            <i class="bi bi-exclamation-triangle-fill text-danger"></i>
                                            <div>
                                                <strong>Allergies</strong>
                                                <p>@Model.MedicalHistory.AllergyDetails</p>
                                            </div>
                                        </li>
                                    }
                                    @if (Model.MedicalHistory.HasChronicIllness)
                                    {
                                        <li class="history-item">
                                            <i class="bi bi-heart-pulse-fill text-warning"></i>
                                            <div>
                                                <strong>Chronic Illness</strong>
                                                <p>@Model.MedicalHistory.ChronicIllnessDetails</p>
                                            </div>
                                        </li>
                                    }
                                    @if (Model.MedicalHistory.IsPregnant)
                                    {
                                        <li class="history-item">
                                            <i class="bi bi-person-fill" style="color: #B76E79;"></i>
                                            <div><strong>Pregnant</strong></div>
                                        </li>
                                    }
                                    @if (Model.MedicalHistory.UsesContraceptives)
                                    {
                                        <li class="history-item">
                                            <i class="bi bi-shield-fill-check" style="color: #4A90A4;"></i>
                                            <div><strong>Uses Contraceptives</strong></div>
                                        </li>
                                    }
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6 class="history-section-title">Lifestyle & Family History</h6>
                                <ul class="history-list">
                                    @if (Model.MedicalHistory.Smokes)
                                    {
                                        <li class="history-item">
                                            <i class="bi bi-circle-fill text-secondary"></i>
                                            <div><strong>Smoker</strong></div>
                                        </li>
                                    }
                                    @if (Model.MedicalHistory.DrinksAlcohol)
                                    {
                                        <li class="history-item">
                                            <i class="bi bi-circle-fill text-secondary"></i>
                                            <div><strong>Consumes Alcohol</strong></div>
                                        </li>
                                    }
                                    @if (Model.MedicalHistory.FamilyHeartDisease)
                                    {
                                        <li class="history-item">
                                            <i class="bi bi-heart-fill text-danger"></i>
                                            <div><strong>Family History: Heart Disease</strong></div>
                                        </li>
                                    }
                                    @if (Model.MedicalHistory.FamilyDiabetes)
                                    {
                                        <li class="history-item">
                                            <i class="bi bi-droplet-fill text-danger"></i>
                                            <div><strong>Family History: Diabetes</strong></div>
                                        </li>
                                    }
                                    @if (Model.MedicalHistory.FamilyCancer)
                                    {
                                        <li class="history-item">
                                            <i class="bi bi-activity text-danger"></i>
                                            <div><strong>Family History: Cancer</strong></div>
                                        </li>
                                    }
                                </ul>
                            </div>
                        </div>
                        @if (!string.IsNullOrEmpty(Model.MedicalHistory.OtherNotes))
                        {
                            <div class="mt-4 pt-3" style="border-top: 1px solid #e9ecef;">
                                <h6 class="history-section-title">Additional Notes</h6>
                                <p class="other-notes">@Model.MedicalHistory.OtherNotes</p>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    }

    <!-- Movement History Section -->
    <div class="row g-4 mt-2">
        <div class="col-12">
            <div class="info-card card-gold">
                <div class="info-card-header">
                    <i class="bi bi-arrow-left-right"></i>
                    <h5>Movement History</h5>
                </div>
                <div class="info-card-body">
                    @if (Model.PatientMovements != null && Model.PatientMovements.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-movement">
                                <thead>
                                    <tr>
                                        <th>Date & Time</th>
                                        <th>From</th>
                                        <th>To</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var movement in Model.PatientMovements.OrderByDescending(m => m.MovedAt))
                                    {
                                        <tr>
                                            <td>@movement.MovedAt.ToString("MMM dd, yyyy HH:mm")</td>
                                            <td><span class="badge badge-from">@movement.FromLocation</span></td>
                                            <td><span class="badge badge-to">@movement.ToLocation</span></td>
                                            <td>
                                                <div class="btn-group-custom">
                                                    <a href="@Url.Action("Details", "PatientMovements", new { id = movement.PatientMovementId })"
                                                       class="btn-icon btn-icon-info"
                                                       title="View Details">
                                                        <i class="bi bi-eye"></i>
                                                    </a>
                                                    <a href="@Url.Action("Edit", "PatientMovements", new { id = movement.PatientMovementId })"
                                                       class="btn-icon btn-icon-warning"
                                                       title="Edit Movement">
                                                        <i class="bi bi-pencil"></i>
                                                    </a>
                                                    <a href="@Url.Action("Delete", "PatientMovements", new { id = movement.PatientMovementId })"
                                                       class="btn-icon btn-icon-danger"
                                                       title="Delete Movement"
                                                       onclick="return confirm('Are you sure you want to delete this movement record?')">
                                                        <i class="bi bi-trash"></i>
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="alert-custom alert-info">
                            <i class="bi bi-info-circle"></i>
                            <span>No movement history recorded for this patient.</span>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="row mt-4 mb-3">
        <div class="col-12">
            <div class="action-buttons">
                <a href="@Url.Action("Edit", new { id = Model.PatientId })" class="btn btn-warning-custom">
                    <i class="bi bi-pencil"></i> Edit Patient Info
                </a>
                <a href="@Url.Action("Create", "PatientMovements", new { patientId = Model.PatientId })" class="btn btn-info-custom">
                    <i class="bi bi-arrow-right"></i> Log New Movement
                </a>
                <a href="@Url.Action("Index")" class="btn btn-secondary-custom">
                    <i class="bi bi-arrow-left"></i> Back to Patient List
                </a>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <style>
        .page-header {
            margin-bottom: 2rem;
        }

        .page-title {
            color: #2c3e50;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

            .page-title i {
                color: #8B1538;
                margin-right: 0.5rem;
            }

        .page-subtitle {
            color: #6c757d;
            font-size: 1rem;
            margin-bottom: 0;
        }

        .info-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #e9ecef;
            height: 100%;
        }

        .info-card-header {
            padding: 1.2rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            font-weight: 600;
            color: white;
        }

            .info-card-header i {
                font-size: 1.3rem;
            }

            .info-card-header h5 {
                margin: 0;
                font-size: 1.1rem;
            }

        .card-burgundy .info-card-header {
            background: linear-gradient(135deg, #8B1538 0%, #B76E79 100%);
        }

        .card-teal .info-card-header {
            background: linear-gradient(135deg, #4A90A4 0%, #7BB3C4 100%);
        }

        .card-rose .info-card-header {
            background: linear-gradient(135deg, #B76E79 0%, #D4A5AA 100%);
        }

        .card-gold .info-card-header {
            background: linear-gradient(135deg, #D4AF37 0%, #E8C547 100%);
        }

        .info-card-body {
            padding: 1.5rem;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 0.8rem 0;
            border-bottom: 1px solid #f1f3f5;
        }

            .info-row:last-child {
                border-bottom: none;
            }

        .info-label {
            font-weight: 600;
            color: #6c757d;
            font-size: 0.9rem;
        }

        .info-value {
            color: #2c3e50;
            text-align: right;
        }

        .badge {
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-weight: 500;
            font-size: 0.85rem;
            display: inline-block;
        }

        .badge-info {
            background: linear-gradient(135deg, #4A90A4 0%, #7BB3C4 100%);
            color: white;
        }

        .badge-ward {
            background: linear-gradient(135deg, #4A90A4 0%, #7BB3C4 100%);
            color: white;
        }

        .badge-gold {
            background: linear-gradient(135deg, #D4AF37 0%, #E8C547 100%);
            color: white;
        }

        .badge-warning {
            background: linear-gradient(135deg, #D4AF37 0%, #E8C547 100%);
            color: white;
        }

        .badge-secondary {
            background: #e9ecef;
            color: #6c757d;
        }

        .badge-active {
            background: linear-gradient(135deg, #16a34a 0%, #4ade80 100%);
            color: white;
        }

        .badge-inactive {
            background: #e9ecef;
            color: #6c757d;
        }

        .badge-from {
            background: #f8f9fa;
            color: #6c757d;
            border: 1px solid #dee2e6;
        }

        .badge-to {
            background: linear-gradient(135deg, #16a34a 0%, #4ade80 100%);
            color: white;
        }

        .history-section-title {
            color: #2c3e50;
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #f1f3f5;
        }

        .history-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .history-item {
            display: flex;
            gap: 0.8rem;
            padding: 0.8rem 0;
            border-bottom: 1px solid #f8f9fa;
        }

            .history-item:last-child {
                border-bottom: none;
            }

            .history-item i {
                font-size: 1.2rem;
                margin-top: 0.2rem;
            }

            .history-item strong {
                color: #2c3e50;
                display: block;
                margin-bottom: 0.3rem;
            }

            .history-item p {
                color: #6c757d;
                margin: 0;
                font-size: 0.9rem;
            }

        .other-notes {
            color: #6c757d;
            line-height: 1.6;
            margin: 0;
        }

        .table-movement {
            margin-bottom: 0;
        }

            .table-movement thead {
                background: #fafafa;
            }

                .table-movement thead th {
                    color: #2c3e50;
                    font-weight: 600;
                    border: none;
                    padding: 1rem;
                    font-size: 0.9rem;
                }

            .table-movement tbody td {
                padding: 1rem;
                vertical-align: middle;
                border-bottom: 1px solid #f1f3f5;
                color: #2c3e50;
            }

            .table-movement tbody tr:hover {
                background: #fafafa;
            }

        .btn-group-custom {
            display: flex;
            gap: 0.3rem;
        }

        .btn-icon {
            width: 32px;
            height: 32px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.3s ease;
            border: 1px solid;
            text-decoration: none;
        }

        .btn-icon-info {
            background: #f0f9ff;
            border-color: #bae6fd;
            color: #4A90A4;
        }

            .btn-icon-info:hover {
                background: #4A90A4;
                color: white;
                transform: translateY(-2px);
            }

        .btn-icon-warning {
            background: #fffbeb;
            border-color: #fde68a;
            color: #D4AF37;
        }

            .btn-icon-warning:hover {
                background: #D4AF37;
                color: white;
                transform: translateY(-2px);
            }

        .btn-icon-danger {
            background: #fff5f7;
            border-color: #fecdd3;
            color: #8B1538;
        }

            .btn-icon-danger:hover {
                background: #8B1538;
                color: white;
                transform: translateY(-2px);
            }

        .alert-custom {
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .alert-info {
            background: #f0f9ff;
            border-color: #bae6fd;
            color: #0c4a6e;
        }

            .alert-info i {
                font-size: 1.5rem;
                color: #4A90A4;
            }

        .action-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .btn-warning-custom {
            background: linear-gradient(135deg, #D4AF37 0%, #E8C547 100%);
            color: white;
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

            .btn-warning-custom:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
                color: white;
            }

        .btn-info-custom {
            background: linear-gradient(135deg, #4A90A4 0%, #7BB3C4 100%);
            color: white;
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

            .btn-info-custom:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(74, 144, 164, 0.3);
                color: white;
            }

        .btn-secondary-custom {
            background: #6c757d;
            color: white;
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

            .btn-secondary-custom:hover {
                background: #5a6268;
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
                color: white;
            }
        @@media (max-width: 768px) {
            .info-row

        {
            flex-direction: column;
            gap: 0.3rem;
        }

        .info-value {
            text-align: left;
        }

        .action-buttons {
            flex-direction: column;
        }

            .action-buttons a {
                width: 100%;
                justify-content: center;
            }

        }
    </style>
}